name: Pre-Release

on:
  push:
    branches:
      - "dev"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: 14
      - run: yarn install
      - run: yarn test
      - run: yarn build
      - run: yarn pack
      - name: "Create new release"
        uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "latest"
          prerelease: true
          title: "Development Build"
          files: |
            aws-azure-login-v3.4*.tgz

#   publish-npm:
#     needs: build
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2
#       - uses: actions/download-artifact@v2
#         with:
#           name: lib
#           path: lib
#       - uses: actions/setup-node@v1
#         with:
#           node-version: 14
#           registry-url: https://registry.npmjs.org/
#       - run: npm publish
#         env:
#           NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

#   publish-docker:
#     needs: build
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2
#       - uses: actions/download-artifact@v2
#         with:
#           name: lib
#           path: lib
#       - name: Publish to Registry
#         uses: elgohr/Publish-Docker-Github-Action@master
#         with:
#           name: sportradar/aws-azure-login
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_PASSWORD }}
#           snapshot: true
#           dockerfile: Dockerfile

#   publish-snap:
#     needs: build
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2
#       - uses: actions/download-artifact@v2
#         with:
#           name: lib
#           path: lib
#       - uses: snapcore/action-build@v1
#         id: build
#       - uses: snapcore/action-publish@v1
#         with:
#           store_login: ${{ secrets.SNAPCRAFT_STORE_LOGIN }}
#           snap: ${{ steps.build.outputs.snap }}
#           release: stable
